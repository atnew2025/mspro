# AI 聊天功能说明

## 🎯 新增功能

### 1. 乱码字符自动清除
- ✅ 自动检测并移除 `�` 字符（Unicode U+FFFD）
- ✅ 清除所有不可见的替换字符
- ✅ 移除零宽字符和控制字符
- ✅ 清理 BOM 和其他编码问题
- ✅ 自动整理空格和换行

### 2. 聊天窗口拖动
- 🖱️ **拖动方式**：点击标题栏并拖动
- 📍 **边界限制**：窗口不会移出屏幕
- 🎯 **智能识别**：不会拖动关闭按钮

### 3. 聊天窗口缩放
- 📏 **缩放手柄**：右下角的 `⋰` 图标
- 🔄 **自由缩放**：拖动手柄调整大小
- 📐 **尺寸限制**：
  - 最小宽度：350px
  - 最小高度：400px
  - 最大尺寸：屏幕大小 - 40px

## 🎨 使用方法

### 拖动窗口
1. 点击聊天窗口顶部的标题栏
2. 按住鼠标左键拖动
3. 松开鼠标完成移动

### 缩放窗口
1. 将鼠标移到窗口右下角
2. 看到 `⋰` 图标时点击并拖动
3. 调整到合适的大小后松开

### 乱码清除
- 自动运行，无需手动操作
- 所有 AI 回复都会自动清理乱码
- 支持的乱码类型：
  - `�` 替换字符
  - 零宽字符
  - 控制字符
  - BOM 标记
  - 多余空格

## 🔧 技术细节

### 字符清理函数
```javascript
cleanGarbledText(text)
- 移除 \uFFFD (�)
- 移除零宽字符
- 移除控制字符
- 清理 BOM
- 整理空格
```

### 拖动实现
```javascript
initChatDragAndResize()
- 监听 mousedown/mousemove/mouseup
- 计算相对位置
- 边界检测
```

### 缩放实现
```javascript
addResizeHandle()
- 动态创建缩放手柄
- 实时计算尺寸
- 最小/最大尺寸限制
```

## 💡 提示

1. **性能优化**：拖动和缩放时会暂时禁用过渡动画
2. **状态保持**：窗口位置和大小在刷新后会重置
3. **响应式**：在移动设备上自动适配屏幕大小
4. **兼容性**：支持所有现代浏览器

## 🐛 已知问题

- 无

## 📝 更新日志

### 2024-11-15
- ✅ 添加乱码字符自动清除
- ✅ 实现窗口拖动功能
- ✅ 实现窗口缩放功能
- ✅ 优化用户体验
